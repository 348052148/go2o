<!doctype html>
<html>
<head>
    <title>会员注册-{{.Map.Merchant.Name}}</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="Stylesheet" href="{{.Var.static_serve}}/css/page.css?spam={{.Var.spam}}" type="text/css"/>
    <link rel="Stylesheet" href="{{.Var.static_serve}}/css/shop/default/style.css?spam={{.Var.spam}}" type="text/css"/>
</head>
<body>
{{template "header".}}
<style type="text/css">
body{overflow: hidden}
</style>
<div class="loading-gate" id="loading-gate">
  <div class="gate"></div><div class="ui-box">数据加载中...</div>
</div>



<div class="ording-wrap">
  <div class="ording-panel">
    <div class="category-panel left" id="category-panel">
        <a class="btn link" do="toggleTop" id="toggleTop">显示导航</a>
      {{.Map.categories}}
    </div>

    <div class="items-panel left" id="items-panel" style="opacity:0;filter:alpha(opacity=0)"></div>
  </div>

  <div class="ording-summary">
      <div id="plcart" class="cart-panel">
      <h3>我的餐盒</h3>
      <div class="cart"></div>
        <div class="submit">
                <a class="green_btn" href="/buy/"><span>提交订单</span></a>
            </div>
    </div>
  </div>

</div>
<!-- 提示：由于物价变动，部分菜品、价格可能有变，详情请以电话确认为准。 -->
<script type="text/javascript" src="{{.Var.static_serve}}/assets/js/core.js?hover=navi&amp;{{.Var.version}}"></script>
<script type="text/javascript" src="{{.Var.static_serve}}/assets/js/ppc.js?e=pc&amp;{{.Var.version}}"></script>
<script type="text/javascript" src="{{.Var.static_serve}}/assets/js/lib/animation.js?{{.Var.version}}"></script>
<script type="text/javascript" src="{{.Var.static_serve}}/assets/js/shopping_cart.js?spam={{.Var.spam}}"></script>

<script type="text/javascript">
  var sw = jr.screen.width();    //page width
  var sh = jr.screen.height();   //page height
  var tog = jr.$('toggleTop');   //toggle navigator
  var togIsLoad = false;        
  var ldgate = jr.$('loading-gate');
  var ldbox = ldgate.getElementsByTagName('DIV')[1];

  var ordPanel = jr.dom.getsByClass(document.body,'ording-panel')[0];
  var catePl = jr.$('category-panel');
  var itemPl = jr.$('items-panel');



function toggleLoading(){
   if(jr.style(ldgate)['display'] == 'none'){
      jr.style(ldgate,{height:sh+'px',width:sw+'px',display:'block'});
      jr.style(ldbox,{top:(sh-ldbox.offsetHeight)/2+'px',left:(sw-ldbox.offsetWidth)/2+'px'});
   }else{
      jr.style(ldgate,{height:'0',width:'0',display:'none'});
   }
}

function ordingInit(){
  loadItemsByCate(15)
  jr.style(ordPanel,{height:(sh-30)+'px',margin:'0'});
  var lis = catePl.getElementsByTagName('LI');
  jr.each(lis,function(i,e){
    jr.event.add(e,'click',(function(lis,t){
      return function(){
        var id= parseInt(t.getAttribute('val'));
        loadItemsByCate(id);
        jr.each(lis,function(i,e){
          e.className = t == e ?'current':'';
        });
      };
    })(lis,e));
  });
}

  function loadItemsByCate(id){
    toggleLoading();
    var dt = new Date() ;
    jr.xhr.get('../list/getList?cid='+id,function(x){
        var dur = new Date() -dt > 1000?0:1000;
        setTimeout(function(){
            if(!togIsLoad){
              togIsLoad=true;
               // window.funcs.toggleTop.apply(tog);
            }
            jr.style(itemPl,{opacity:0,filter:"alpha(opacity=0)"});
            if(x.length<10){
              itemPl.innerHTML='<p style="font-size:200%;color:#FF0000;margin:0 auto;padding:20% 0;text-align:center;">没有商品</p>';
            }else{
              itemPl.innerHTML=x;
            }
            toggleLoading();
           jr.animation.show(itemPl,null,4);

        },dur);
    },function(x){jr.$('fditems').innerHTML='加载失败';});
  }


	//backToTop(990);
	if(!window.XMLHttpRequest){tagFloat('cartHidden','bottom',35);
		tagFloat('rightcart','bottom',340);
		tagFloat('notNear','center');
		tagFloat('feedback1','center');
	}
  ordingInit();
</script>



<script type="text/javascript">
var plcart=document.getElementById('plcart');
cart.init(plcart.id,false);
</script>



</body>
</html>
