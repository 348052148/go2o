<!DOCTYPE html>
<html>
<head>
	<title>分类管理</title>
    <link href="{{.Var.static_serve}}/assets/mui/css/latest/page_style.css?v={{.Var.version}}" rel="stylesheet" type="text/css" />
    <link href="{{.Var.static_serve}}/css/partner/partner.css?spam={{.Var.spam}}" rel="stylesheet" type="text/css" />
</head>
<body>

<div class="form margin30" id="form1">
    <div class="fl">
        <div class="label"><span class="red">*&nbsp;</span>分类名称：</div>
        <div class="in">
                <input type="hidden" field="Id" value="0" />
                <input type="text" field="Name" class="ui-validate ui-box" required="true" />
        </div>
    </div>

    <div class="fl">
        <div class="label"><span class="red">*&nbsp;</span>上级分类：</div>
        <div class="in">
            <select class="ui-validate ui-box" field="ParentId">
                <option value="0">一根目录一</option>
                {{.Map.CateOpts}}
            </select>
        </div>
    </div>

    <div class="fl">
        <div class="label"><span class="red">*&nbsp;</span>图标：</div>
        <div class="in" style="position: relative;height:100px;">
            <img id="upload_img" src="{{.Map.Icon}}"
                 style="float:left;margin-right:10px;width: 75px; height:75px;border:solid 1px #aaa;"/>
            <input class="ui-validate ui-box" length="[0,150]" type="hidden" field="Icon" id="upload_path"/>
            <span id="upload_btn"><button>选择图片上传</button></span>
        </div>
    </div>

    <div class="fl">
        <div class="label"><span class="red">*&nbsp;</span>是否启用：</div>
        <div class="in">
            <input type="radio" name="Enabled" field="Enabled" value="1" id="State1" checked="checked"/><label for="State1">启用</label>
            <input type="radio" name="Enabled" field="Enabled" value="0" id="State2"/><label for="State2">停用</label>
        </div>
    </div>
    <div class="fl">
        <div class="label"><span class="red">*&nbsp;</span>排序：</div>
        <div class="in">
            <input class="ui-validate ui-box" field="SortNumber" required="true" isnumber="true" style="width:30px" value="0"/>
            * 排序数字，越小排列越靠前
        </div>
    </div>
    <div class="fl">
        <div class="label"><span class="red">*&nbsp;</span>分类描述：</div>
        <div class="in">
            <textarea field="Description" class="ui-validate ui-box tb_normal" length="[0,150]" style="height:80px"></textarea>
        </div>
    </div>
    <div class="fl">
        <div class="label">&nbsp;</div>
        <div class="in">
            <span class="ui-button w150" id="btn_save"><span class="button-inner"><span class="button-txt">保存</span><a href="javascript:;"></a></span></span>
            <span class="ui-button w150"><span class="button-inner"><span class="button-txt">重置</span><input type="reset" value="reset" /></span></span>
        </div>
    </div>
</div>

    <script src="{{.Var.static_serve}}/assets/js/core_full.js?spam={{.Var.spam}}"></script>
    <script src="{{.Var.static_serve}}/assets/js/export.js?spam={{.Var.spam}}"></script>
    <script src="{{.Var.static_serve}}/assets/js/plugins/sys.js?spam={{.Var.spam}}"></script>
    
    <script>
    var entity ={{.Map.Entity}} ||{};
    j6.json.bind('form1', entity);

    //上传缩略图
    j6.upload({
        id: 'upload_btn',
        debug: !true,
        url: '/upload.cgi?type=category-icon',
        exts: '*.gif;*.jpg;*.png;*.bmp'
    }, function (result, data) {
        if (result) {
            jr.$('upload_path').value = data.url;
            jr.$('upload_img').src = '{{.Var.img_serve}}/' + data.url;
        } else {
            alert('上传失败：' + data);
        }
    });

    jr.$('btn_save').onclick = function() {
        if (j6.validator.validate('form1')) {
            var data = j6.json.toObject('form1');
            j6.xhr.jsonPost('SaveCategory', data, function (json) {
                window.parent.$.messager.alert('提示', json.result ? '保存成功！' : json.message, 'ok', function () {
                    j6.tab.closeAndRefresh('分类管理');
                });
            }, function (e) {
                window.parent.$.messager.alert('提示', " 保存失败！ ", 'error');
            });
        }
    }
    
    </script>
</body>
</html>
